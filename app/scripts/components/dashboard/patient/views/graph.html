<div class="container admin-user">
	<div class="col-md-16 margin-top reset-padding mob_no_margin">
		<div class="user-gen-details">
			<span class="user-gen-details--name">{{slectedPatient.firstName}} {{slectedPatient.lastName}}</span>
			<span class="user-gen-details--hr-id">{{slectedPatient.hillromId}}</span>
		</div>
	</div>
</div>
		<div class="container patient_wrapper">
			<div class="col-md-16 padding_0">
				<div class="row">
					<div class="col-md-16 col-sm-16 padding_0">
						<div class="stats_chart_section">
							<div class="stats_header"><h4 translate="graph.statistics"></h4></div>
							<div class="stats_chart_container">
								<div class="col-3 hover_symbol" ng-click="$parent.adherenceTable = true; getAdherenceScore()">
									<div class="pie_chart" easypiechart options="adherence" percent="adherenceScore"></div>
									<div class="stats_chart_content score">
										<h4 class="percent" ng-bind="adherenceScore"></h4>
										<p class="descrip" translate="graph.adherence-score"></p>
									</div>
									<div class="chart_inner_icon icon-adherence"></div>
								</div>
								<div class="col-3">
									<div class="pie_chart"  easypiechart options="hmr" percent="hmrRunRate"></div>
									<div class="stats_chart_content hmr">
										<h4 class="percent"  ng-bind="hmrRunRate"></h4>
										<p class="descrip" translate="graph.hmr-runrate" ></p>
									</div>
									<div class="chart_inner_icon icon-man-running"></div>
								</div>
								<div class="col-3">
									<div class="pie_chart"  easypiechart options="missedtherapy" percent="missedtherapyDays"></div>
									<div class="stats_chart_content missed">
										<h4 class="percent" ng-bind="missedtherapyDays"></h4>
										<p class="descrip" translate="graph.missed-therapy-days"> </p>
									</div>
									<div class="chart_inner_icon icon-lungs"></div>
								</div>
								<div class="col-3">
									<div class="pie_chart"  easypiechart options="settingDeviation" percent="settingsDeviatedDaysCount"></div>
									<div class="stats_chart_content deviation">
										<h4 class="percent" ng-bind="settingsDeviatedDaysCount"></h4>
										<p class="descrip" translate="graph.setting-deviation-days"> </p>
									</div>
									<div class="chart_inner_icon icon-settings"></div>
								</div>
							</div>
							<div class="col-md-16 adherence_details_wrapper" ng-show="adherenceTable">
								<div class="row">
									<div class="col-md-16 header_adherence_details">
									<div class="row">
										<div class="col-md-15">
											<p class="head_txt" translate="graph.adherence-score-table.title"></p>
										</div>
										<div class="col-md-1">
											<span class="pull-right"><a class="close" href="javascript:void(0)" ng-click="$parent.adherenceTable = false">X</a></span>
										</div>
									</div>
								</div>
								<table class="table">
									<thead>
										<tr>
											<th class="col-md-4" translate="graph.adherence-score-table.date">Date</th>
											<th class="col-md-8">
											<table class="col-md-16 row">
												<thead>
													<tr class="col-md-16 row">
														<th  class="col-md-8 inner_th" translate="graph.adherence-score-table.notification"></th>
														<th class="col-md-8 inner_th text-center" translate="graph.adherence-score-table.change"></th>
													</tr>
												</thead>
											</table>
											</th>
											<!-- <th class="col-md-4 text-center" >Change</th> -->
											<th class="col-md-4 text-center" translate="graph.adherence-score-table.updated-score">Updated Score</th>
										</tr>
									</thead>
									<tbody>
										<tr ng-repeat="adherenceScore in adherenceScores">
											<td class="col-md-4">{{adherenceScore.date}}</td>
											<td class="col-md-8">
												<table class="col-md-16 row">
													<tbody>
														<tr class="col-md-16 row" ng-repeat="(key, val) in adherenceScore.notificationPoints">
															<td class="inner_td col-md-8">{{key}}</td>
															<td class="inner_td col-md-8 text-center">{{val}}</td>
														</tr>
													</tbody>

												</table>	 
											</td>
											<!-- <td class="col-md-4 text-center">{{adherenceScore.change}}</td> -->
											<td class="col-md-4 text-center">{{adherenceScore.updatedScore}}</td>
										</tr>
									</tbody>
								</table>
								</div>

							</div>
						</div>
					</div>					
				</div>
			</div>
			
		<loading loaded="isGraphLoaded"></loading>		
	<!-- adding new section for graphs -->
	<div class="col-md-16 padding0" ng-class="{'pointer-no-event': !isGraphLoaded, 'pointer-fill-event': isGraphLoaded}">
		<div class="bar_graph_header">
			<div class="col-md-5 col-sm-7 left_header_barchart padding0">
				<div class="row">
					<ul class="nav nav-pills">
					<li><a ng-class="{active: isHMR}" href="" ng-click="isGraphLoaded && getHMR()" translate="graph.hmr-data"></a></li>
					<li><a href="" ng-class="{active: !isHMR}" ng-click="isGraphLoaded && getCompliance()" translate="graph.compliance"></a></li>
				</ul>
				</div>
			</div>
			<div class="col-md-11 col-sm-9 right_header_barchart">
				<ul class="nav nav-pills pull-right ">
					<li role="presentation" class=""><a href="" ng-class="{active: durationRange === 'Day'}" ng-hide="complianceGraph" ng-click="isGraphLoaded && getDayChart()" translate="graph.day"></a></li>
					<li role="presentation" class=""><a ng-class="{active: durationRange === 'Week'}" href="" ng-click="isGraphLoaded && getWeekChart()">Week</a></li>
					<li role="presentation" class=""><a href="" ng-class="{active: durationRange === 'Month'}" ng-click="isGraphLoaded && getMonthChart()" translate="graph.month"></a></li>
					<li role="presentation" class=""><a href="" ng-class="{active: durationRange === 'Year'}" ng-click="isGraphLoaded && getYearChart()" translate="graph.year"></a></li>
					<li role="presentation" class="" id="dp1"><a href="" date-range-picker class="date-picker" ng-model="dates" parentEl="#dp1" options="opts" ><span class="icon-calendar"></span></a></li>
				</ul>
			</div>
		</div>
		<div class="pull-right week_date_container">
			<span ng-if="fromDate !== toDate">
					<span class="date">{{fromDate}}</span> - <span class="date">{{toDate}}</span>
			</span>
			<span ng-if="fromDate === toDate" class="date">{{fromDate}}<span>
		</div>
	</div>
	<div class="col-md-16" class="all_graph_wrapper" >	
	<div class="graph_nodata" ng-if="noDataAvailable">
		<span class="noData_text"> No Data Available!</span>
	</div><!--  ng-show="isHMR && !noDataAvailable"-->	
	<div class="complianceGraphPrim_wrapper" ng-show="!noDataAvailable" id="lineGraphWrapper" >
		<div id="HMRGraph" ng-class="{ 'hide-chart': !isHMR, 'show-chart': isHMR}" ng-init="initHMR()">
			
		</div>
	</div><!-- ng-show="!noDataAvailable && !isHMR"-->
	<div id="complianceGraphWrapper" >
		<div id="complianceGraphPrim" ng-show="!noDataAvailable" class="complianceGraphPrim_wrapper" >
			<div id="synchronizedChart" class="complianceGraph col-md-16" ng-class="{ 'hide-chart': isHMR, 'show-chart': !isHMR}">
			</div>
		</div>
	</div>
	</div>

	<!-- ending new section of graphs -->

	<!-- Note section HTML -->
	<div class="col-md-16" style="margin-top: 30px;">
		<div class="btn_group patient_dashdoard_btns" ng-class="{ 'btn_group patient_dashdoard_btns_compliance': complianceGraph, 'btn_group patient_dashdoard_btns': !complianceGraph}">
			<div dropdown class="pull-right left">
				<button id="single-button" type="button" class="hillrom-btn btn-submit margin0 float-right" ng-class="{ 'pointer-fill-event': (!noDataAvailable && isGraphLoaded) , 'pointer-no-event': (!isGraphLoaded || noDataAvailable) }" dropdown-toggle ng-disabled="disabled" translate="graph.download" >
					<span class="caret"></span>
				</button>
				
				<ul class="dropdown-menu" role="menu" aria-labelledby="single-button" ng-if="!noDataAvailable">
					<li role="menuitem">
						<a href="javascript:void(0);" ng-click="downloadAsPdf();" translate="graph.export-as-pdf"></a>
					</li>					
					<li role="menuitem">
						<a href="javascript:void(0);" ng-click="downloadRawDataAsCsv();" translate="graph.export-raw-data"></a>
					</li>
				</ul>

			</div>
			 <button class="hillrom-btn btn-submit margin0 float-right" ng-click="showAllNotes();" translate="graph.note"></button>


		</div>
	</div>
	<div class="col-md-16 hide_content" id="add_note_container">
		<div class="add_note_container">
			<div class="note_header">
				<div class="col-md-14 col-sm-12 note_header_left pull-left-mob">
					<span class="note" translate="graph.note"></span>
					<span class="can_do" translate="graph.can-do" ng-show="role === 'PATIENT'"></span>
				</div>
				<div class="col-md-2 col-sm-4 note_header_right"><a href="" class="pull-right cross_icon" ng-click="hideNoteContainer();">X</a></div>
			</div>
			<div class="notes_content" ng-repeat="note in notes track by $index" ng-show="note.note.length > 0 && !note.deleted">
				<div class="col-md-16 notes_row">
					<div class="notes_row_wrapper">
						<div class="col-md-2 col-sm-4 date_col view_content show_content" id="createdon_{{note.id}}"><span ng-bind="note.createdOn"></span></div>
						<div class="col-md-11 col-sm-8 description view_content show_content" id="viewnote_{{note.id}}" ng-bind="note.note"></div>
						<form ng-submit="updateNote(note.id, note.createdOn);">
						<div id="editform_{{note.id}}" class="col-md-16 edit_content hide_content" ng-show="role === 'PATIENT'" >
						<div class="col-md-16">
   	<p class="col-md-offset-2">System not monitored 24/7. If you have an emergency, please call 911</p>
   </div>
							<div class="col-md-2 col-sm-3">
								<span ng-bind="note.createdOn"></span>
							</div>
							<div class="col-md-9 col-sm-6 description">
								<div class="form-group note_edit_container">
									<textarea id="editedNoteText_{{note.id}}" value="{{note.note}}" maxlength="300"  class="form-control custom_textarea" rows="1"></textarea>
									<span class="has-error" ng-show="noteError" ng-bind="noteError" id="noteError_{{note.id}}"></span>
								</div>
							</div>

							<div class="col-md-5 col-sm-7 edit_delete">
								<div class="pull-right">
									<input type="button"  value="Cancel" ng-click="cancelEditNote(note.id);" class="hillrom-btn btn-submit float-right" />
									<input type="submit" id="submit" value="Update" class="hillrom-btn btn-submit float-right" />
								</div>
							</div>
						</div>
						</form>
						<div class="col-md-3 col-sm-4 edit_delete" ng-show="role === 'PATIENT'">
							<div class="pull-right view_note_act view_content show_content note_delete_edit" id="viewnoteact_{{note.id}}">
								<span class="edit icon glyphicon glyphicon-pencil" styel="cursor:pointer;" ng-click="openEditNote(note.id, note.note);"></span>
								<span class="delete icon icon-delete-icon" styel="cursor:pointer;" ng-click="openDeleteNoteModal(note);" ></span>

							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="notes_content" ng-if="notes.length <= 0 && !addNoteActive">
				<center><span translate="graph.no-data-found"></span></center>
			</div>


   <div class="col-md-16 note_edit_container hide_content" id="note_edit_container" ng-show="role === 'PATIENT'">
   <div class="col-md-16">
   	<p class="col-md-offset-2">System not monitored 24/7. If you have an emergency, please call 911</p>
   </div>
	<form name="form" ng-submit="createNote();">
		<div class="col-md-2 col-sm-4 date_col">
			<input class="date_input"  data-provide="datepicker"  data-date-format="yyyy-mm-dd"  bootstrap-datepicker data-date-end-date="0d"   data-date-start-date="{{transmissionDate}}" id="edit_note_date" ng-model="textNote.edit_date" placeholder="Date"/></div>
			<div class="col-md-11 col-sm-8 description">
				<div class="form-group">

					<textarea class="form-control custom_textarea" rows="1" id="comment" ng-model="textNote.text" maxlength="300"></textarea>
				</div>
				<div>
					<span class="has-error" ng-if="noteTextError">
						{{noteTextError}}
					</span>
				</div>
			</div>
			<div class="col-md-3 edit_delete">
				<div class="pull-right">
					<span class="float-right view_all_btn" ng-click="cancelAddNote();">X</span>
					<button class="hillrom-btn btn-submit float-right save" translate="graph.save"></button>
				</div>
			</div>
		</form>
	</div>
	<div class="btn_group patient_dashdoard_btns" ng-show="role === 'PATIENT' && hasTransmissionDate">
		<button class="hillrom-btn btn-submit float-right" ng-click="openAddNote();" translate="graph.add-note"></button>
	</div>
	<div class="dashboard__manage-view--pagination pagination_notes" ng-if="notes.length > 0">
        <div class="col-md-16">
          <div class="navbar-right">
            <span class="record-found" >{{notes.length}}
	            <span translate="graph.notes" ng-if="notes.length > 1"></span>
	            <span translate="graph.note" ng-if="notes.length == 1"></span>
            </span>
            <span class="record-found" translate="graph.found"></span>
            <span ng-show="perPageCount > 1">
              <span class="navigaion-link cursor-pointer" ng-class="{ 'inactive': !(curNotePageIndex > 1) }" ng-click="showAllNotes('PREV')" translate="graph.previous"></span>
              <span class="navigaion-no">{{curNotePageIndex}}</span>
              <span class="navigaion-link cursor-pointer" ng-class="{ 'inactive': !(notePageCount > curNotePageIndex) }" ng-click="showAllNotes('NEXT')" translate="graph.next"></span>
            </span>
          </div>
          <div class="clr"></div>
        </div>
      </div>
</div>
</div>
</div>
		</div>
		<div id= "png-container" ></div>
		<canvas id="canvas" width="1800px" height="1800px" class="graph-canvas-hide"></canvas>
		<canvas id="HMRCCanvas" width=1300 height=350 style="display:none;"></canvas>


<div ng-if="deleteNoteModal" class="modal" id="sg-modal" tabIndex="-1" role="dialog" aria-labelledby="sgModalLabel" aria-hidden="true">
  <div class="modal__dialog">
    <div class="modal__content">
      <header class="modal__header">
        <button type="button" class="modal__close" data-dismiss="modal" ng-click="closeNoteDeleteModal()">&times;</button>
         <p translate="patient.delete-note.warning"></p>
      </header>
      <div class="modal__body">
         <div class="modal--message" translate="patient.delete-note.message"></div>
         <div class="fropile_update_btn_group row modal--custom-btn">
          <buton class="hillrom-btn btn-submit float-right" ng-click="deleteNote(noteToDelete.id)">Yes</buton>
          <buton class="cancel hillrom-btn btn-submit float-right" data-dismiss="modal" ng-click="closeNoteDeleteModal()">No</buton>
         </div>
      </div>
      <footer class="modal__footer">
      </footer>
    </div>
  </div>
</div>

<!-- modal to show graph is loading -->
<div class="modal" id="no-xls-modal" tabIndex="-1" role="dialog" aria-labelledby="sgModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal__dialog">
    <div class="modal__content">
      <header class="modal__header">
        <button type="button" class="modal__close graph_close_btn" data-dismiss="modal" ng-click="cloaseXLSModal()">&times;</button>
        <p >{{header}}</p>
      </header>
      <div class="modal__body">
        <div class="modal--message">No therapy done within the selected duration</div>        
      </div>
      <footer class="modal__footer">
      </footer>
    </div>
  </div>
</div>
<div class="modal" id="graph-loading-modal" tabIndex="-1" role="dialog" aria-labelledby="sgModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal__dialog">
    <div class="modal__content">
      <header class="modal__header">
        <button type="button" class="modal__close graph_close_btn" data-dismiss="modal" ng-click="cloasePDFModal()">&times;</button>
        <p >{{header}}</p>
      </header>
      <div class="modal__body">
        <div class="modal--message">PDF is loading. Please wait for sometime.</div>        
      </div>
      <footer class="modal__footer">
      </footer>
    </div>
  </div>
</div>

<div ng-if="surveyConfirmModal" id="survey_confirm_modal" class="modal" id="sg-modal" tabIndex="-1" role="dialog" aria-labelledby="sgModalLabel" aria-hidden="true">
  <div class="modal__dialog">
    <div class="modal__content">
      <header class="modal__header">
        <button type="button" class="modal__close" data-dismiss="modal" ng-click="$parent.surveyConfirmModal = false">&times;</button>
        <p ng-if="surveyId === 1" translate="survey.5-days-header"> </p> 
        <p ng-if="surveyId === 2" translate="survey.30-days-header"> </p> 
        <p ng-if="surveyId === 3" translate="survey.90-days-header"> </p>
      </header>
      <div class="modal__body">
        <div class="modal--message">Please complete the following survey. Press the Start button below to begin the survey.</div>
       <!--  <div class="modal--message">Press Start button below and start the Survey</div> -->
        <div class="row modal--custom-btn">
          <buton class="hillrom-btn btn-submit float-right" ng-click="$parent.surveyConfirmModal = false;takeSurveyNow(); ">Start</buton>
          <buton class="hillrom-btn btn-submit float-right" data-dismiss="modal" ng-click="$parent.surveyConfirmModal = false">Later</buton>
        </div>
      </div>
      <footer class="modal__footer">
      </footer>
    </div>
  </div>
</div>

